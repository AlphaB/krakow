<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
<title>
  File: README
  
    &mdash; Documentation by YARD 0.8.7.4
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!file.README.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'><h1>Krakow</h1>

<p>&quot;KRAKOW! KRAKOW! Two direct hits!&quot;</p>

<h2>Spiff</h2>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>krakow</span><span class='tstring_end'>'</span></span>

<span class='id identifier rubyid_producer'>producer</span> <span class='op'>=</span> <span class='const'>Krakow</span><span class='op'>::</span><span class='const'>Producer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
  <span class='symbol'>:host</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>HOST</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:port</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>PORT</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:topic</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>target</span><span class='tstring_end'>'</span></span>
<span class='rparen'>)</span>
<span class='id identifier rubyid_producer'>producer</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>KRAKOW!</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>KRAKOW!</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
</code></pre>

<h2>Zargons</h2>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>krakow</span><span class='tstring_end'>'</span></span>

<span class='id identifier rubyid_consumer'>consumer</span> <span class='op'>=</span> <span class='const'>Krakow</span><span class='op'>::</span><span class='const'>Consumer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
  <span class='symbol'>:nsqlookupd</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>http://HOST:PORT</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:topic</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>target</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ship</span><span class='tstring_end'>'</span></span>
<span class='rparen'>)</span>

<span class='id identifier rubyid_consumer'>consumer</span><span class='period'>.</span><span class='id identifier rubyid_queue'>queue</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='comment'># =&gt; 2
</span><span class='int'>2</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='id identifier rubyid_consumer'>consumer</span><span class='period'>.</span><span class='id identifier rubyid_queue'>queue</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_msg'>msg</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_consumer'>consumer</span><span class='period'>.</span><span class='id identifier rubyid_confirm'>confirm</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_message_id'>message_id</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</code></pre>

<h2>What is this?</h2>

<p>It&#39;s a Ruby library for <a href="http://bitly.github.io/nsq/" title="NSQ: a realtime distributed messaging platform">NSQ</a> using <a href="http://celluloid.io" title="Celluloid: Actor-based concurrent object framework for Ruby">Celluloid</a> under the hood.</p>

<h2>Information and FAQ that I totally made up</h2>

<h3>Max in flight for consumers is 1, regardless of number of producers</h3>

<p>Yep, that&#39;s right. Just one lowly message at a time. And that&#39;s probably not what
you want, so adjust it when you create your consumer instance.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>krakow</span><span class='tstring_end'>'</span></span>

<span class='id identifier rubyid_consumer'>consumer</span> <span class='op'>=</span> <span class='const'>Krakow</span><span class='op'>::</span><span class='const'>Consumer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
  <span class='symbol'>:nsqlookupd</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>http://HOST:PORT</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:topic</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>target</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ship</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:max_in_flight</span> <span class='op'>=&gt;</span> <span class='int'>30</span>
<span class='rparen'>)</span>
</code></pre>

<h3>Clean up after yourself</h3>

<p>Since <a href="http://celluloid.io" title="Celluloid: Actor-based concurrent object framework for Ruby">Celluloid</a> is in use under the hood, and the main interaction points are
Actors (<code>Consumer</code> and <code>Producer</code>) you&#39;ll need to be sure you clean up. This simply
means terminating the instance (since falling out of scope will not cause it to be
garbage collected).</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_consumer'>consumer</span> <span class='op'>=</span> <span class='const'>Krakow</span><span class='op'>::</span><span class='const'>Consumer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
  <span class='symbol'>:nsqlookupd</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>http://HOST:PORT</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:topic</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>target</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ship</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:max_in_flight</span> <span class='op'>=&gt;</span> <span class='int'>30</span>
<span class='rparen'>)</span>

<span class='comment'># do stuff
</span>
<span class='id identifier rubyid_consumer'>consumer</span><span class='period'>.</span><span class='id identifier rubyid_terminate'>terminate</span>
</code></pre>

<h3>Please make it shutup!</h3>

<p>Sure:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>Krakow</span><span class='op'>::</span><span class='const'>Utils</span><span class='op'>::</span><span class='const'>Logging</span><span class='period'>.</span><span class='id identifier rubyid_level'>level</span> <span class='op'>=</span> <span class='symbol'>:warn</span> <span class='comment'># :debug / :info / :warn / :error / :fatal
</span></code></pre>

<h3>Why is it forcing something called an &quot;unready state&quot;?</h3>

<p>Because forcing starvation is mean.</p>

<h3>I just want to connect to a producer, not a lookup service</h3>

<p>Fine!</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_consumer'>consumer</span> <span class='op'>=</span> <span class='const'>Krakow</span><span class='op'>::</span><span class='const'>Consumer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
  <span class='symbol'>:host</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>HOST</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:port</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>PORT</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:topic</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>target</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ship</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:max_in_flight</span> <span class='op'>=&gt;</span> <span class='int'>30</span>
<span class='rparen'>)</span>
</code></pre>

<p>Great for testing, but you really should use the lookup service in the &quot;real world&quot;</p>

<h3>Backoff support</h3>

<p>NSQ has this backoff notion. It&#39;s pretty swell. Basically, if messages from a specific
producer get re-queued (fail), then message consumption from that producer is halted,
and slowly ramped back up. It gives time for downstream issues to work themselves out,
if possible, instead of just keeping the firehose of gasoline on. Neat.</p>

<p>By default backoff support is disabled. It can be enabled by setting the <code>:backoff_interval</code>
when constructing the <code>Consumer</code>. The interval is in seconds (and yes, floats are allowed
for sub-second intervals):</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_consumer'>consumer</span> <span class='op'>=</span> <span class='const'>Krakow</span><span class='op'>::</span><span class='const'>Consumer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
  <span class='symbol'>:nsqlookupd</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>http://HOST:PORT</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:topic</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>target</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ship</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:max_in_flight</span> <span class='op'>=&gt;</span> <span class='int'>30</span><span class='comma'>,</span>
  <span class='symbol'>:backoff_interval</span> <span class='op'>=&gt;</span> <span class='int'>1</span>
<span class='rparen'>)</span>
</code></pre>

<h3>I need TLS!</h3>

<p>OK!</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_consumer'>consumer</span> <span class='op'>=</span> <span class='const'>Krakow</span><span class='op'>::</span><span class='const'>Consumer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
  <span class='symbol'>:nsqlookupd</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>http://HOST:PORT</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:topic</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>target</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ship</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:connection_options</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
    <span class='symbol'>:features</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
      <span class='symbol'>:tls_v1</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span>
<span class='rparen'>)</span>
</code></pre>

<h3>I need Snappy compression!</h3>

<p>OK!</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_consumer'>consumer</span> <span class='op'>=</span> <span class='const'>Krakow</span><span class='op'>::</span><span class='const'>Consumer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
  <span class='symbol'>:nsqlookupd</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>http://HOST:PORT</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:topic</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>target</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ship</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:connection_options</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
    <span class='symbol'>:features</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
      <span class='symbol'>:snappy</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span>
<span class='rparen'>)</span>
</code></pre>

<h3>I need Deflate compression!</h3>

<p>OK!</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_consumer'>consumer</span> <span class='op'>=</span> <span class='const'>Krakow</span><span class='op'>::</span><span class='const'>Consumer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
  <span class='symbol'>:nsqlookupd</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>http://HOST:PORT</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:topic</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>target</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ship</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:connection_options</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
    <span class='symbol'>:features</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
      <span class='symbol'>:deflate</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span>
<span class='rparen'>)</span>
</code></pre>

<h3>I want to use TLS based authentication!</h3>

<p>OK!</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_consumer'>consumer</span> <span class='op'>=</span> <span class='const'>Krakow</span><span class='op'>::</span><span class='const'>Consumer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
  <span class='symbol'>:nsqlookupd</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>http://HOST:PORT</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:topic</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>target</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ship</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:connection_options</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
    <span class='symbol'>:features</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
      <span class='symbol'>:tls_v1</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>
    <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='symbol'>:config</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
      <span class='symbol'>:ssl_context</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
        <span class='symbol'>:certificate</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/path/to/cert</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
        <span class='symbol'>:key</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/path/to/key</span><span class='tstring_end'>'</span></span>
      <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span>
<span class='rparen'>)</span>
</code></pre>

<h3>Running the tests</h3>

<p>Run them all!</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ruby'>ruby</span> <span class='id identifier rubyid_test'>test</span><span class='op'>/</span><span class='id identifier rubyid_run'>run</span><span class='period'>.</span><span class='id identifier rubyid_rb'>rb</span>
</code></pre>

<p>Or, run part of them:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_ruby'>ruby</span> <span class='id identifier rubyid_test'>test</span><span class='op'>/</span><span class='id identifier rubyid_specs'>specs</span><span class='op'>/</span><span class='id identifier rubyid_consumer_spec'>consumer_spec</span><span class='period'>.</span><span class='id identifier rubyid_rb'>rb</span>
</code></pre>

<h3>It doesn&#39;t work</h3>

<p>Create an issue on the github repository.</p>

<h3>It doesn&#39;t do <code>x</code></h3>

<p>Create an issue, or even better, send a PR. Just base it off the <code>develop</code> branch.</p>

<h1>Info</h1>

<ul>
<li>Repo: <a href="https://github.com/chrisroberts/krakow">https://github.com/chrisroberts/krakow</a></li>
<li>IRC: Freenode @ spox</li>
</ul>
</div></div>

    <div id="footer">
  Generated on Sat May 10 12:40:46 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.4 (ruby-1.9.3).
</div>

  </body>
</html>